<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Geb√§udetrocknung Wiegand ‚Äì KI Analyse</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d1117;
    --surface: #161b22;
    --surface2: #1c2330;
    --border: #30363d;
    --accent: #e8a020;
    --text: #e6edf3;
    --text-muted: #8b949e;
    --success: #3fb950;
    --danger: #f85149;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-weight: 300;
    min-height: 100vh;
  }
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(232,160,32,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(232,160,32,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* LOGIN */
  #loginScreen {
    position: fixed;
    inset: 0;
    background: var(--bg);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
  }
  .login-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 48px 40px;
    width: 100%;
    max-width: 420px;
    text-align: center;
  }
  .login-box h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    letter-spacing: 0.1em;
    margin-bottom: 4px;
  }
  .login-box h1 span { color: var(--accent); }
  .login-box p {
    color: var(--text-muted);
    font-size: 0.85rem;
    margin-bottom: 32px;
  }
  .login-box input {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    padding: 14px 16px;
    border-radius: 10px;
    outline: none;
    margin-bottom: 16px;
    text-align: center;
    letter-spacing: 0.2em;
  }
  .login-box input:focus { border-color: var(--accent); }
  .login-btn {
    width: 100%;
    background: var(--accent);
    color: #0d1117;
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 0.15em;
    padding: 16px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .login-btn:hover { opacity: 0.9; transform: translateY(-1px); }
  .login-error {
    color: var(--danger);
    font-size: 0.85rem;
    margin-top: 12px;
    display: none;
  }

  /* MAIN APP */
  #app { display: none; position: relative; z-index: 1; }
  .container { max-width: 860px; margin: 0 auto; padding: 48px 24px; }

  .header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 40px;
    padding-bottom: 28px;
    border-bottom: 1px solid var(--border);
  }
  .logo-area h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    letter-spacing: 0.08em;
    line-height: 1;
  }
  .logo-area h1 span { color: var(--accent); }
  .logo-area p {
    font-size: 0.75rem;
    color: var(--text-muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-top: 6px;
  }
  .badge {
    background: rgba(232,160,32,0.12);
    border: 1px solid rgba(232,160,32,0.3);
    color: var(--accent);
    font-size: 0.7rem;
    font-weight: 500;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 5px 12px;
    border-radius: 20px;
  }

  .form-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 24px;
  }
  .form-card h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 0.1em;
    color: var(--accent);
    margin-bottom: 20px;
  }

  /* API KEY */
  .api-row {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .api-row label {
    font-size: 0.78rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    white-space: nowrap;
    font-weight: 500;
  }
  .api-row input {
    flex: 1;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: monospace;
    font-size: 0.85rem;
    padding: 10px 14px;
    border-radius: 8px;
    outline: none;
  }
  .api-row input:focus { border-color: var(--accent); }

  .field { margin-bottom: 18px; }
  .field label {
    display: block;
    font-size: 0.78rem;
    font-weight: 500;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 8px;
  }
  .field input, .field textarea {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    font-weight: 300;
    padding: 12px 16px;
    border-radius: 10px;
    outline: none;
    transition: border-color 0.2s;
  }
  .field input:focus, .field textarea:focus { border-color: var(--accent); }
  .field textarea { min-height: 100px; resize: vertical; line-height: 1.6; }

  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

  /* UPLOAD ZONE */
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }
  .upload-zone:hover, .upload-zone.dragover {
    border-color: var(--accent);
    background: rgba(232,160,32,0.04);
  }
  .upload-zone input {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }
  .upload-icon { font-size: 2.5rem; margin-bottom: 12px; }
  .upload-zone p { color: var(--text-muted); font-size: 0.9rem; }
  .upload-zone p span { color: var(--accent); }
  .upload-preview {
    margin-top: 16px;
    display: none;
  }
  .upload-preview img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 8px;
    border: 1px solid var(--border);
  }
  .upload-preview p {
    margin-top: 8px;
    color: var(--success);
    font-size: 0.85rem;
  }

  .btn-analyze {
    width: 100%;
    background: var(--accent);
    color: #0d1117;
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 0.15em;
    padding: 18px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
    margin-top: 8px;
  }
  .btn-analyze:hover { opacity: 0.9; transform: translateY(-1px); }
  .btn-analyze:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .loading {
    display: none;
    text-align: center;
    padding: 48px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    margin-bottom: 24px;
  }
  .loading.active { display: block; }
  .spinner {
    width: 40px; height: 40px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 16px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading p { color: var(--text-muted); font-size: 0.9rem; }

  .result-card {
    display: none;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 24px;
  }
  .result-card.active { display: block; }
  .result-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border);
  }
  .result-header h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 0.1em;
    color: var(--success);
  }
  .btn-copy {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text-muted);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.8rem;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-copy:hover { border-color: var(--accent); color: var(--accent); }
  .result-content {
    font-size: 0.95rem;
    line-height: 1.8;
    white-space: pre-wrap;
  }
  .result-content h3 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.05rem;
    letter-spacing: 0.08em;
    color: var(--accent);
    margin: 20px 0 6px;
  }

  .error-box {
    display: none;
    background: rgba(248,81,73,0.08);
    border: 1px solid rgba(248,81,73,0.3);
    color: var(--danger);
    padding: 14px 18px;
    border-radius: 10px;
    font-size: 0.9rem;
    margin-bottom: 16px;
  }
  .error-box.active { display: block; }

  .footer {
    text-align: center;
    color: var(--text-muted);
    font-size: 0.75rem;
    padding-top: 28px;
    border-top: 1px solid var(--border);
  }

  @media (max-width: 600px) {
    .row { grid-template-columns: 1fr; }
    .header { flex-direction: column; gap: 12px; }
    .api-row { flex-direction: column; align-items: flex-start; }
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <h1>GEB√ÑUDE<span>TROCKNUNG</span> WIEGAND</h1>
    <p>Internes Tool ‚Äì nur f√ºr Mitarbeiter</p>
    <input type="password" id="loginInput" placeholder="Passwort eingeben" onkeydown="if(event.key==='Enter')doLogin()" />
    <button class="login-btn" onclick="doLogin()">EINLOGGEN</button>
    <p class="login-error" id="loginError">‚ùå Falsches Passwort</p>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div class="container">

    <div class="header">
      <div class="logo-area">
        <h1>GEB√ÑUDE<span>TROCKNUNG</span> WIEGAND</h1>
        <p>KI-gest√ºtzte Sanierungsanalyse ¬∑ Intern</p>
      </div>
      <div class="badge">üîí Nur intern</div>
    </div>

    <!-- API KEY -->
    <div class="form-card">
      <h2>API Einstellung</h2>
      <div class="api-row">
        <label>OpenAI Key</label>
        <input type="password" id="apiKey" placeholder="sk-..." />
      </div>
    </div>

    <!-- FEHLER -->
    <div class="error-box" id="errorBox"></div>

    <!-- FORMULAR -->
    <div class="form-card">
      <h2>Neue Schadensanalyse</h2>

      <div class="row">
        <div class="field">
          <label>Objekt / Adresse</label>
          <input type="text" id="objekt" placeholder="z.B. EFH, Musterstr. 5, Eschwege" />
        </div>
        <div class="field">
          <label>Art des Schadens</label>
          <input type="text" id="schadensart" placeholder="z.B. Wasserschaden, Schimmel" />
        </div>
      </div>

      <!-- FOTO UPLOAD -->
      <div class="field">
        <label>Foto des Schadens hochladen</label>
        <div class="upload-zone" id="uploadZone">
          <input type="file" id="fileInput" accept="image/*" onchange="handleFile(this)" />
          <div class="upload-icon">üì∑</div>
          <p>Foto hier ablegen oder <span>klicken zum Ausw√§hlen</span></p>
          <p style="font-size:0.78rem; margin-top:6px;">JPG, PNG, WEBP</p>
          <div class="upload-preview" id="uploadPreview">
            <img id="previewImg" src="" alt="Vorschau" />
            <p id="fileName"></p>
          </div>
        </div>
      </div>

      <div class="field">
        <label>Beschreibung des Zustands</label>
        <textarea id="zustand" placeholder="Beschreiben Sie den aktuellen Zustand: Welche R√§ume sind betroffen? Wie sehen W√§nde, B√∂den, Decken aus? Gibt es sichtbare Sch√§den, Verf√§rbungen, Ger√ºche?"></textarea>
      </div>

      <div class="field">
        <label>√Ñnderungsw√ºnsche / gew√ºnschte Ma√ünahmen</label>
        <textarea id="wuensche" placeholder="Was soll gemacht werden? z.B. W√§nde trockenlegen, Schimmel entfernen, Estrich erneuern..."></textarea>
      </div>

      <button class="btn-analyze" id="analyzeBtn" onclick="analyze()">
        KI-Analyse starten ‚Üí
      </button>
    </div>

    <!-- LOADING -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>KI analysiert den Schaden... bitte warten</p>
    </div>

    <!-- ERGEBNIS -->
    <div class="result-card" id="resultCard">
      <div class="result-header">
        <h2>‚úì Analyse abgeschlossen</h2>
        <button class="btn-copy" onclick="copyResult()">Kopieren</button>
      </div>
      <div class="result-content" id="resultContent"></div>
    </div>

    <div class="footer">
      Geb√§udetrocknung Wiegand ¬∑ Forstgasse 19a ¬∑ 37269 Eschwege ¬∑ Internes Tool
    </div>
  </div>
</div>

<script>
  // ===== PASSWORT =====
  const PASSWORD = "wiegand2024";

  function doLogin() {
    const val = document.getElementById('loginInput').value;
    if (val === PASSWORD) {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('app').style.display = 'block';
    } else {
      document.getElementById('loginError').style.display = 'block';
    }
  }

  // ===== FOTO UPLOAD =====
  let uploadedImageBase64 = null;

  function handleFile(input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      uploadedImageBase64 = e.target.result.split(',')[1];
      document.getElementById('previewImg').src = e.target.result;
      document.getElementById('fileName').textContent = '‚úì ' + file.name;
      document.getElementById('uploadPreview').style.display = 'block';
    };
    reader.readAsDataURL(file);
  }

  // Drag & Drop
  const zone = document.getElementById('uploadZone');
  zone.addEventListener('dragover', (e) => { e.preventDefault(); zone.classList.add('dragover'); });
  zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
  zone.addEventListener('drop', (e) => {
    e.preventDefault();
    zone.classList.remove('dragover');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) {
      const input = document.getElementById('fileInput');
      const dt = new DataTransfer();
      dt.items.add(file);
      input.files = dt.files;
      handleFile(input);
    }
  });

  // ===== ANALYSE =====
  async function analyze() {
    const apiKey = document.getElementById('apiKey').value.trim();
    const objekt = document.getElementById('objekt').value.trim();
    const schadensart = document.getElementById('schadensart').value.trim();
    const zustand = document.getElementById('zustand').value.trim();
    const wuensche = document.getElementById('wuensche').value.trim();

    const errorBox = document.getElementById('errorBox');
    errorBox.className = 'error-box';

    if (!apiKey) { showError('Bitte OpenAI API Key eingeben.'); return; }
    if (!zustand && !uploadedImageBase64) { showError('Bitte Beschreibung eingeben oder Foto hochladen.'); return; }

    const btn = document.getElementById('analyzeBtn');
    btn.disabled = true;
    document.getElementById('loading').className = 'loading active';
    document.getElementById('resultCard').className = 'result-card';

    const promptText = `Du bist ein erfahrener Bausachverst√§ndiger f√ºr die Firma Geb√§udetrocknung Wiegand in Eschwege.

Erstelle eine vollst√§ndige Sanierungsanalyse auf Deutsch:

Objekt: ${objekt || 'Nicht angegeben'}
Schadensart: ${schadensart || 'Nicht angegeben'}
Zustand: ${zustand || 'Siehe Foto'}
W√ºnsche: ${wuensche || 'Nicht angegeben'}

Analysiere und erstelle:

### 1. SCHADENSBEURTEILUNG
Bewerte den Zustand (W√§nde, B√∂den, Decken). Sch√§tze Schweregrad ein.

### 2. EMPFOHLENE MA√üNAHMEN
Liste alle n√∂tigen Ma√ünahmen auf.

### 3. SANIERUNGSKONZEPT
Schritt-f√ºr-Schritt Vorgehen.

### 4. KOSTENSCH√ÑTZUNG
- Trocknung & Technik: X‚Ç¨
- R√ºckbau: X‚Ç¨
- Material: X‚Ç¨
- Handwerker: X‚Ç¨
- Nebenkosten: X‚Ç¨

### 5. GESAMTKOSTEN
Sch√§tzung gesamt: X‚Ç¨ ‚Äì X‚Ç¨

### 6. F√ñRDERM√ñGLICHKEITEN
KfW, BAFA, Versicherung

### 7. BEN√ñTIGTE GEWERKE
Welche Fachbetriebe werden zus√§tzlich ben√∂tigt?`;

    try {
      let messages;

      if (uploadedImageBase64) {
        messages = [{
          role: "user",
          content: [
            {
              type: "image_url",
              image_url: { url: `data:image/jpeg;base64,${uploadedImageBase64}` }
            },
            { type: "text", text: promptText }
          ]
        }];
      } else {
        messages = [{ role: "user", content: promptText }];
      }

      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'gpt-4o',
          max_tokens: 2000,
          messages: messages
        })
      });

      const data = await response.json();

      if (!response.ok) {
        showError('API Fehler: ' + (data.error?.message || response.status));
        return;
      }

      displayResult(data.choices[0].message.content);

    } catch (err) {
      showError('Verbindungsfehler: ' + err.message);
    } finally {
      btn.disabled = false;
      document.getElementById('loading').className = 'loading';
    }
  }

  function displayResult(text) {
    const el = document.getElementById('resultContent');
    el.innerHTML = text
      .replace(/### (.+)/g, '<h3>$1</h3>')
      .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    document.getElementById('resultCard').className = 'result-card active';
    document.getElementById('resultCard').scrollIntoView({ behavior: 'smooth' });
  }

  function showError(msg) {
    const el = document.getElementById('errorBox');
    el.textContent = msg;
    el.className = 'error-box active';
    document.getElementById('loading').className = 'loading';
    document.getElementById('analyzeBtn').disabled = false;
  }

  function copyResult() {
    const text = document.getElementById('resultContent').innerText;
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.querySelector('.btn-copy');
      btn.textContent = '‚úì Kopiert!';
      setTimeout(() => btn.textContent = 'Kopieren', 2000);
    });
  }
</script>
</body>
</html>
